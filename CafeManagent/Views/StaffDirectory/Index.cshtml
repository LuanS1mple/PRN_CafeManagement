@model CafeManagent.dto.response.PagedResult<CafeManagent.dto.response.StaffListItemDto>
@{
    var q = (CafeManagent.dto.response.StaffListQuery)ViewBag.Query;
    ViewData["Title"] = "Danh sách nhân viên";
}
<link rel="stylesheet" href="~/css/Profile.css" />

<div class="container">
    <div class="page-header">
        <div>
            <h2 class="title">Danh sách nhân viên</h2>
            <div class="sub">Quản lý thông tin nhân viên trong công ty</div>
        </div>
        <a class="btn primary" asp-controller="StaffProfile" asp-action="Create">+ Thêm nhân viên</a>
    </div>

    <form method="get" action="@Url.Action("Index","StaffDirectory")" class="toolbar">
        <input class="input search" type="text" name="q" value="@q?.Q" placeholder="Tìm theo tên/email..." />
        <select class="input" name="status">
            <option value="" selected="@(q?.Status==null)">Trạng thái</option>
            <option value="1" selected="@(q?.Status==1)">Đang làm việc</option>
            <option value="2" selected="@(q?.Status==2)">Nghỉ phép</option>
            <option value="3" selected="@(q?.Status==3)">Nghỉ việc</option>
        </select>
        <input type="hidden" name="page" value="1" />  <!-- quan trọng: khi bấm Lọc, về page 1 -->
        <button class="btn">Lọc</button>
    </form>

    <div class="card table-card">
        <table class="table">
            <thead>
                <tr>
                    <th style="width:42px;"></th>
                    <th>Avatar</th>
                    <th>Họ tên</th>
                    <th>Email</th>
                    <th>Chức danh</th>
                    <th>Trạng thái</th>
                    <th>Ngày vào làm</th>
                    <th>Hết hạn HĐ</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model.Items)
                {
                    <tr class="row-link" onclick="location.href='@Url.Action("Details","StaffDirectory", new { id = s.StaffId })'">
                        <td><input type="checkbox" /></td>
                        <td><img src="@s.AvatarUrl?v=@DateTimeOffset.UtcNow.Ticks" class="avatar-sm" /></td>
                        <td>@s.FullName</td>
                        <td>@s.Email</td>
                        <td>@s.Title</td>
                        <td><span class="badge @(s.Status=="Đang làm việc"?"badge-green": s.Status=="Nghỉ phép"?"badge-yellow":"badge-gray")">@s.Status</span></td>
                        <td>@(s.JoinDate?.ToString("dd/MM/yyyy"))</td>
                        <td>@(s.ContractEndDate?.ToString("dd/MM/yyyy"))</td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="pager">
            @{
                var prevDisabled = Model.Page <= 1 ? "disabled" : "";
                var nextDisabled = Model.Page >= Model.TotalPages ? "disabled" : "";
            }
            <a class="pager-btn @prevDisabled" href="@Url.Action("Index", new { q = q.Q, status = q.Status, page = Model.Page-1, size = Model.Size })">‹ Previous</a>
            <span class="pager-num">@Model.Page</span>
            <a class="pager-btn @nextDisabled" href="@Url.Action("Index", new { q = q.Q, status = q.Status, page = Model.Page+1, size = Model.Size })">Next ›</a>
        </div>
    </div>
</div>
@model CafeManagent.dto.request.UpdateStaffProfile
@{
    ViewData["Title"] = "Sửa hồ sơ nhân viên";
    var roles = ViewBag.Roles as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem> ?? new();
    var avatar = (string?)(ViewBag.Avatar ?? "/images/avatars/default.png");
}

<link rel="stylesheet" href="~/css/StaffEdit.css" />

<div class="container profile-wrap">
    <h2>Sửa hồ sơ</h2>

    <form asp-action="Edit" asp-controller="StaffDirectory" asp-route-id="@Model.StaffId"
          method="post" enctype="multipart/form-data" class="profile-grid">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="StaffId" />

        <aside class="card left-card">
            <div class="avatar-wrap">
                <img id="avatarPreview" class="avatar-circle" src="@avatar" alt="Avatar preview" />
            </div>

            <label class="btn btn-upload" for="avatarFile">
                <span class="icon-up">⌃</span> Tải ảnh lên
            </label>
            <input id="avatarFile" type="file" name="avatarFile" accept="image/*" style="display:none" />
            <div class="label" style="margin-top:8px;">PNG/JPG/WEBP ≤ 2MB</div>
        </aside>

        <section class="card right-card">
            <h3>Thông tin</h3>

            <!-- Tóm tắt lỗi -->
            <div asp-validation-summary="ModelOnly" class="val-summary"></div>

            <div class="kv2" style="grid-template-columns:1fr 1fr;">
                <div class="kv2-row">
                    <div class="kv2-label">Role</div>
                    <div class="kv2-value">
                        <select class="input" asp-for="RoleId" asp-items="@roles">
                            <option value="">— Chọn vai trò —</option>
                        </select>
                        <span asp-validation-for="RoleId" class="text-danger"></span>
                    </div>
                </div>

                <div class="kv2-row">
                    <div class="kv2-label">Họ và tên</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="FullName" maxlength="100" />
                        <span asp-validation-for="FullName" class="text-danger"></span>
                    </div>
                </div>

                <div class="kv2-row">
                    <div class="kv2-label">Giới tính</div>
                    <div class="kv2-value">
                        <select class="input" asp-for="Gender">
                            <option value="">—</option>
                            <option value="true">Nam</option>
                            <option value="false">Nữ</option>
                        </select>
                        <span asp-validation-for="Gender" class="text-danger"></span>
                    </div>
                </div>

                <div class="kv2-row">
                    <div class="kv2-label">Ngày sinh</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="BirthDate" type="date" />
                        <span asp-validation-for="BirthDate" class="text-danger"></span>
                    </div>
                </div>

                <div class="kv2-row">
                    <div class="kv2-label">Email</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="Email" maxlength="200" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                </div>

                <div class="kv2-row">
                    <div class="kv2-label">Điện thoại</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="Phone" maxlength="9" placeholder="9 chữ số" />
                        <span asp-validation-for="Phone" class="text-danger"></span>
                    </div>
                </div>

                <div style="grid-column:1/-1" class="kv2-row">
                    <div class="kv2-label">Địa chỉ</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="Address" maxlength="255" />
                        <span asp-validation-for="Address" class="text-danger"></span>
                    </div>
                </div>


                <!-- Contract fields -->
                <div class="kv2-row">
                    <div class="kv2-label">Chức danh (HĐ)</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="Position" maxlength="100" />
                        <span asp-validation-for="Position" class="text-danger"></span>
                    </div>
                </div>

                <div class="kv2-row">
                    <div class="kv2-label">Ngày hết hạn HĐ</div>
                    <div class="kv2-value">
                        <input class="input" asp-for="ContractEndDate" type="date" />
                        <span asp-validation-for="ContractEndDate" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="actions">
                <a class="btn secondary" asp-action="Details" asp-controller="StaffDirectory" asp-route-id="@Model.StaffId">Hủy</a>
                <button class="btn primary" type="submit">Lưu thay đổi</button>
            </div>
        </section>
    </form>
</div>

@section Scripts {
    <script>
        const fileInput = document.getElementById('avatarFile');
        const avatar = document.getElementById('avatarPreview');
        if (fileInput && avatar) {
            fileInput.addEventListener('change', (e) => {
                const f = e.target.files?.[0];
                if (!f) return;
                const url = URL.createObjectURL(f);
                avatar.src = url;
            });
        }
    </script>
    <partial name="_ValidationScriptsPartial" />
}

@using CafeManagent.dto.response.OrderModuleDTO
@model List<OrderDto>
@{
    // Tên View mới được dùng cho cả Waiter/Bartender History
    ViewData["Title"] = "Lịch sử Đơn hàng đã xong (Bartender)";
}

<h2 class="text-center mb-4">Lịch sử Order Đã Hoàn Thành & Sẵn Sàng (Bartender) 🍹</h2>
<hr />

<div class="d-flex justify-content-start mb-3">
    @* Sửa đường dẫn quay lại trỏ về màn hình đang hoạt động của Bartender *@
    <a href="/Order/Bartender" class="btn btn-secondary">
        <i class="fa-solid fa-arrow-left me-2"></i>Quay lại màn hình Đang xử lý
    </a>
</div>

<div class="card shadow-sm">
    @* Sửa tiêu đề thẻ để phản ánh đúng nội dung *@
    <div class="card-header bg-dark text-white fw-bold">Danh sách Order đã hoàn thành </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col" style="width: 5%;">ID</th>
                        <th scope="col" style="width: 20%;">Khách hàng</th>
                        <th scope="col" style="width: 15%;">Tổng tiền</th>
                        <th scope="col" style="width: 20%;">Thời gian</th>
                        <th scope="col" style="width: 15%;">Trạng thái</th>
                        <th scope="col" style="width: 25%;" class="text-end">Chi tiết</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Any())
                    {
                        @foreach (var order in Model)
                        {
                            // Chỉ dùng HTML thuần vì không cần nút Hoàn tiền ở đây
                            <tr class="order-row" id="order-@order.OrderId" data-status="@order.Status">
                                <th scope="row">#@order.OrderId</th>
                                <td>@order.CustomerName</td>
                                <td><strong data-amount="@(order.TotalAmount)">@order.TotalAmount?.ToString("N0", new System.Globalization.CultureInfo("vi-VN")) VND</strong></td>
                                <td>@order.OrderTime</td>
                                <td>
                                    @{
                                        // Giữ nguyên logic xác định màu badge
                                        string badgeClass = order.Status switch
                                        {
                                            2 => "bg-success", // Đã sẵn sàng
                                            3 => "bg-secondary", // Hoàn thành
                                            _ => "bg-info"
                                        };
                                    }
                                    <span class="badge @badgeClass">@order.StatusText</span>
                                </td>
                                <td class="text-end">
                                    <a href="/Order/Details/@order.OrderId" class="btn btn-sm btn-info" title="Xem chi tiết"><i class="fa-solid fa-eye"></i> Xem chi tiết</a>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center text-muted">Không có đơn hàng nào đã hoàn tất.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
@using CafeManagent.dto.request.StaffModuleDTO;
@model UpdateStaffProfile
@{
    ViewData["Title"] = "Sửa hồ sơ";
    var avatar = (string?)(ViewBag.Avatar ?? "/images/avatars/default.png");
}

<link rel="stylesheet" href="~/css/EditProfile.css" />

<div class="container profile-wrap">
    <form asp-controller="StaffProfile" asp-action="Edit" asp-route-id="@Model.StaffId" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="StaffId" />

        <div class="profile-grid">
            <!-- LEFT CARD -->
            <aside class="card left-card">
                <div class="avatar-wrap">
                    @{
                        var bust = DateTimeOffset.UtcNow.Ticks;
                    }
                    <img class="avatar-circle" id="avatarPreview" src="@avatar?v=@bust" alt="Avatar" />
                </div>

                <label class="btn btn-upload" for="avatarFile">
                    <span class="icon-up">⌃</span> Tải ảnh lên
                </label>
                <input id="avatarFile" type="file" name="avatarFile" accept="image/*" style="display:none" />
                <div class="label" style="margin-top:8px;">PNG/JPG/WEBP ≤ 2MB</div>
            </aside>

            <!-- RIGHT CARD -->
            <section class="card right-card">
                <div class="tabs">
                    <span class="tab active">Thông tin</span>
                    <a class="tab" href="javascript:void(0)">Bảo mật</a>
                </div>

                <!-- TÓM TẮT LỖI -->
                <div asp-validation-summary="All" class="val-summary"></div>

                <div class="kv2">
                    <div class="kv2-row">
                        <div class="kv2-label">Họ và tên</div>
                        <div class="kv2-value">
                            <input class="input" asp-for="FullName" />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="kv2-row">
                        <div class="kv2-label">Giới tính</div>
                        <div class="kv2-value">
                            <select class="input" asp-for="Gender">
                                <option value="">—</option>
                                <option value="true">Nam</option>
                                <option value="false">Nữ</option>
                            </select>
                            <span asp-validation-for="Gender" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="kv2-row">
                        <div class="kv2-label">Ngày sinh</div>
                        <div class="kv2-value">
                            <input class="input" asp-for="BirthDate" type="date" />
                            <span asp-validation-for="BirthDate" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="kv2-row">
                        <div class="kv2-label">Email</div>
                        <div class="kv2-value">
                            <input class="input" asp-for="Email" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="kv2-row">
                        <div class="kv2-label">Điện thoại</div>
                        <div class="kv2-value">
                            <input class="input" asp-for="Phone" />
                            <span asp-validation-for="Phone" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="kv2-row">
                        <div class="kv2-label">Địa chỉ</div>
                        <div class="kv2-value">
                            <input class="input" asp-for="Address" />
                            <span asp-validation-for="Address" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <a class="btn secondary" asp-controller="StaffProfile" asp-action="Profile" asp-route-id="@Model.StaffId">Hủy</a>
                    <button class="btn primary" type="submit">Lưu thay đổi</button>
                </div>
            </section>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Preview avatar
        const fileInput = document.getElementById('avatarFile');
        const avatar = document.getElementById('avatarPreview');
        if (fileInput && avatar) {
          fileInput.addEventListener('change', (e) => {
            const f = e.target.files?.[0];
            if (!f) return;
            const url = URL.createObjectURL(f);
            avatar.src = url;
          });
        }
    </script>
}
